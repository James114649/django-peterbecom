!function(e,t){"use strict";function n(e,n){var a=t.createElement(e);for(var l in n)a[l]=n[l];return a}function a(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent(t,n)}function l(){var e,t,n,a,l,r,u,o=[].slice;for(a=arguments[0],n=2<=arguments.length?o.call(arguments,1):[],r=0,u=n.length;u>r;r++){t=n[r];for(e in t)l=t[e],a[e]=l}return a}function r(r,u){function o(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function s(e){var t=E.map(o),n=new RegExp("\\b("+t.join("|")+")","gi");return e.replace(n,"<b>$1</b>")}function i(e){"P"===e.target.tagName&&b!==+e.target.dataset.i&&(b=+e.target.dataset.i,c())}function c(){var e,a;if(null!==L){if(L.length){x.style.display="block";var l=x.getElementsByTagName("p");for(e=l.length-1;e>=0;e--)l[e].remove()}else x.style.display="none";y=[];var u,i,c=null,d=[];L.length||(C.value=r.value);var v=E.map(o),p=new RegExp("\\b("+v.join("|")+")(\\w+)\\b","gi"),f=t.createDocumentFragment();for(e=0,a=L.length;a>e;e++){for(var m,g;null!==(m=p.exec(L[e][1]));)g=new RegExp("\\b"+o(m[0])+"\\b","gi"),c=m[m.length-1],void 0===c||g.test(r.value)||b===e&&d.push(c);u=n("p"),e===b&&u.classList.add("selected"),u.dataset.i=e,i=n("a",{innerHTML:s(L[e][1]),href:"/plog/"+L[e][0]}),u.appendChild(i),f.appendChild(u),y.push(u)}x.appendChild(f),d.length&&" "!==r.value.charAt(r.value.length-1)?(c=d[b%d.length],C.value=r.value+c):C.value=r.value}}function d(e){var t=e.parentNode;if("FORM"===t.nodeName)return t;if(null===t)throw"too deep. no parent form node to be found";return d(t)}function v(t){var n,a;if("tab"===t)C.value!==r.value&&(r.value=C.value+" "),r.value!==C.value&&m();else if("down"===t||"up"===t){for("down"===t?b=Math.min(y.length-1,++b):"up"===t&&(b=Math.max(0,--b)),n=0,a=y.length;a>n;n++)n===b?y[n].classList.add("selected"):y[n].classList.remove("selected");c()}else if("enter"===t){if(!y.length)return d(r).submit(),!0;var l=y[b],u=l.getElementsByTagName("a")[0];r.value=C.value=u.textContent,x.style.display="none",e.location=u.href}else"esc"===t&&(x.style.display="none");return!1}function p(e){var t={13:"enter",9:"tab",38:"up",40:"down",27:"esc"};return t[e.keyCode]?(e.preventDefault(),v(t[e.keyCode])):!1}function f(){x.style.display="none"}function m(){if(!r.value.trim())return C.value="",void(x.style.display="none");if(b=0,k[r.value.trim()]){var t=k[r.value.trim()];E=t.terms,L=t.results,c()}else{var n;e.XMLHttpRequest?n=new XMLHttpRequest:e.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var e=JSON.parse(n.responseText);k[r.value.trim()]=e,E=e.terms,L=e.results,c()}else console.warn(n.status,n.responseText),f()},n.open("GET",u.url+encodeURIComponent(r.value.trim()),!0),n.send()}}function g(e){C.value=r.value,setTimeout(function(){x.style.display="none"},200),e.preventDefault()}function h(){r.value.length&&y.length&&(x.style.display="block")}u=u||{},u=l({url:"/autocomplete",key:"q"},u||{}),u.url+=(u.url.indexOf("?")>-1?"&":"?")+u.key+"=";var y=[],b=0;r.spellcheck=!1,r.autocomplete="off";var w=n("span",{className:"_ac-wrap"}),C=n("input",{tabindex:-1,spellcheck:!1,autocomplete:"off",readonly:"readonly",type:"text",className:r.className+" _ac-hint"});r.classList.add("_ac-foreground"),w.appendChild(C);var N=r.cloneNode(!0);w.appendChild(N);var x=n("div",{className:"_ac-results"});a(x,"mouseover",i),w.appendChild(x),r.parentElement.insertBefore(w,r),r.parentNode.removeChild(r),r=N;var E,L=null,k={};a(r,"input",m),a(r,"keydown",p),a(r,"blur",g),a(r,"focus",h),r.value.length&&m()}e.AutoComplete=r}(window,document);